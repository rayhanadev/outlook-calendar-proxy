<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Normical - Fix Outlook Calendar Sync</title>

		<meta
			name="description"
			content="Normalize Outlook ICS feeds for reliable Google Calendar sync. No more duplicate events or timezone issues."
		/>
		<meta name="author" content="Normical" />

		<meta property="og:type" content="website" />
		<meta property="og:title" content="Normical" />
		<meta
			property="og:description"
			content="Fix Outlook calendar sync issues with Google Calendar. Normalizes ICS feeds to eliminate duplicates and timezone problems."
		/>
		<meta property="og:image" content="https://normical.com/og.png" />
		<meta property="og:url" content="https://normical.com" />

		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content="Normical" />
		<meta
			name="twitter:description"
			content="Fix Outlook calendar sync issues with Google Calendar. Normalizes ICS feeds to eliminate duplicates and timezone problems."
		/>
		<meta name="twitter:image" content="https://normical.com/og.png" />

		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="apple-touch-icon" href="/favicon.svg" />
		<meta name="theme-color" content="#000000" />

		<style>
			@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			body {
				font-family: 'JetBrains Mono', 'SF Mono', Monaco, 'Cascadia Code', monospace;
				background: #fff;
				color: #000;
				min-height: 100vh;
				padding: 0;
			}

			.grid-bg {
				position: fixed;
				inset: 0;
				background-image:
					linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
					linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
				background-size: 24px 24px;
				pointer-events: none;
				z-index: 0;
			}

			.container {
				position: relative;
				z-index: 1;
				max-width: 640px;
				margin: 0 auto;
				padding: 80px 24px;
			}

			header {
				margin-bottom: 64px;
			}

			.logo {
				display: inline-flex;
				align-items: center;
				gap: 12px;
				margin-bottom: 48px;
			}

			.logo-mark {
				width: 32px;
				height: 32px;
				background: #000;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.logo-mark span {
				color: #fff;
				font-size: 14px;
				font-weight: 600;
			}

			.logo-text {
				font-size: 14px;
				font-weight: 500;
				letter-spacing: -0.01em;
			}

			h1 {
				font-size: 32px;
				font-weight: 500;
				letter-spacing: -0.02em;
				line-height: 1.2;
				margin-bottom: 16px;
			}

			.subtitle {
				font-size: 14px;
				color: #666;
				line-height: 1.6;
			}

			.card {
				background: #fafafa;
				border: 1px solid #e5e5e5;
				padding: 32px;
			}

			label {
				display: block;
				font-size: 11px;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: #666;
				margin-bottom: 8px;
			}

			input {
				width: 100%;
				padding: 12px 16px;
				background: #fff;
				border: 1px solid #e5e5e5;
				font-family: inherit;
				font-size: 13px;
				color: #000;
				transition: border-color 0.15s;
			}

			input:focus {
				outline: none;
				border-color: #000;
			}

			input::placeholder {
				color: #999;
			}

			select {
				width: 100%;
				padding: 12px 16px;
				margin-top: 16px;
				background: #fff;
				border: 1px solid #e5e5e5;
				font-family: inherit;
				font-size: 13px;
				color: #000;
				cursor: pointer;
				transition: border-color 0.15s;
				appearance: none;
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: right 16px center;
			}

			select:focus {
				outline: none;
				border-color: #000;
			}

			select option {
				font-family: inherit;
			}

			.select-wrapper {
				margin-top: 16px;
			}

			.select-wrapper label {
				margin-bottom: 8px;
			}

			.select-wrapper select {
				margin-top: 8px;
			}

			button {
				width: 100%;
				padding: 12px 16px;
				margin-top: 16px;
				background: #000;
				border: 1px solid #000;
				color: #fff;
				font-family: inherit;
				font-size: 13px;
				font-weight: 500;
				cursor: pointer;
				transition:
					background 0.15s,
					color 0.15s;
			}

			button:hover {
				background: #fff;
				color: #000;
			}

			.result {
				margin-top: 24px;
				padding: 16px;
				background: #fff;
				border: 1px solid #e5e5e5;
				display: none;
			}

			.result.show {
				display: block;
			}

			.result-label {
				font-size: 11px;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: #666;
				margin-bottom: 8px;
			}

			.result-url {
				font-size: 12px;
				color: #000;
				word-break: break-all;
				cursor: pointer;
				padding: 8px;
				background: #f5f5f5;
				border: 1px dashed #ccc;
			}

			.result-url:hover {
				background: #eee;
			}

			.copied {
				font-size: 11px;
				color: #000;
				margin-top: 8px;
				opacity: 0;
				transition: opacity 0.15s;
			}

			.copied.show {
				opacity: 1;
			}

			.error {
				color: #c00;
				margin-top: 16px;
				font-size: 12px;
			}

			.features {
				margin-top: 48px;
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 1px;
				background: #e5e5e5;
				border: 1px solid #e5e5e5;
			}

			.feature {
				background: #fff;
				padding: 24px;
			}

			.feature-title {
				font-size: 11px;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				margin-bottom: 8px;
			}

			.feature-desc {
				font-size: 12px;
				color: #666;
				line-height: 1.5;
			}

			footer {
				margin-top: 48px;
				padding-top: 24px;
				border-top: 1px solid #e5e5e5;
				font-size: 11px;
				color: #999;
			}

			footer code {
				font-family: inherit;
				background: #f5f5f5;
				padding: 2px 6px;
				border: 1px solid #e5e5e5;
			}

			footer a {
				color: #000;
				text-decoration: none;
			}

			footer a:hover {
				text-decoration: underline;
			}

			.credit {
				margin-top: 16px;
				color: #999;
			}

			@media (max-width: 600px) {
				.features {
					grid-template-columns: 1fr;
				}
				h1 {
					font-size: 24px;
				}
			}
		</style>
	</head>
	<body>
		<div class="grid-bg"></div>

		<div class="container">
			<header>
				<div class="logo">
					<div class="logo-mark"><span>N</span></div>
					<span class="logo-text">Normical</span>
				</div>

				<h1>Fix Outlook calendar sync</h1>
				<p class="subtitle">
					Normalizes Outlook ICS feeds for reliable Google Calendar sync. No more duplicate events or timezone issues.
				</p>
			</header>

			<div class="card">
				<form id="form">
					<label for="url">ICS Calendar URL</label>
					<input type="url" id="url" name="url" placeholder="https://outlook.office365.com/owa/calendar/..." required />

					<div class="select-wrapper">
						<label for="timezone">Timezone (optional)</label>
						<select id="timezone" name="timezone">
							<option value="">Use server default (UTC)</option>
							<optgroup label="Americas">
								<option value="America/New_York">Eastern Time (America/New_York)</option>
								<option value="America/Chicago">Central Time (America/Chicago)</option>
								<option value="America/Denver">Mountain Time (America/Denver)</option>
								<option value="America/Los_Angeles">Pacific Time (America/Los_Angeles)</option>
								<option value="America/Anchorage">Alaska Time (America/Anchorage)</option>
								<option value="Pacific/Honolulu">Hawaii Time (Pacific/Honolulu)</option>
								<option value="America/Halifax">Atlantic Time (America/Halifax)</option>
								<option value="America/Sao_Paulo">Brasilia Time (America/Sao_Paulo)</option>
							</optgroup>
							<optgroup label="Europe &amp; Africa">
								<option value="UTC">UTC</option>
								<option value="Europe/London">London (Europe/London)</option>
								<option value="Europe/Paris">Paris (Europe/Paris)</option>
								<option value="Europe/Berlin">Berlin (Europe/Berlin)</option>
								<option value="Europe/Moscow">Moscow (Europe/Moscow)</option>
							</optgroup>
							<optgroup label="Asia &amp; Pacific">
								<option value="Asia/Dubai">Dubai (Asia/Dubai)</option>
								<option value="Asia/Kolkata">India (Asia/Kolkata)</option>
								<option value="Asia/Singapore">Singapore (Asia/Singapore)</option>
								<option value="Asia/Shanghai">China (Asia/Shanghai)</option>
								<option value="Asia/Tokyo">Tokyo (Asia/Tokyo)</option>
								<option value="Australia/Sydney">Sydney (Australia/Sydney)</option>
								<option value="Pacific/Auckland">Auckland (Pacific/Auckland)</option>
							</optgroup>
						</select>
					</div>

					<button type="submit">Generate proxy URL</button>
				</form>

				<div class="result" id="result">
					<div class="result-label">Your Proxy URL</div>
					<div class="result-url" id="result-url" onclick="copyUrl()"></div>
					<div class="copied" id="copied">Copied to clipboard</div>
				</div>

				<div class="error" id="error"></div>
			</div>

			<div class="features">
				<div class="feature">
					<div class="feature-title">Stable UIDs</div>
					<div class="feature-desc">Prevents duplicate events from unstable Outlook identifiers</div>
				</div>
				<div class="feature">
					<div class="feature-title">Timezone Fix</div>
					<div class="feature-desc">Correctly handles timezone conversions and edge cases</div>
				</div>
				<div class="feature">
					<div class="feature-title">Cancellations</div>
					<div class="feature-desc">Properly emits cancellation events for deleted items</div>
				</div>
			</div>

			<footer>
				<div>To delete your calendar data, append <code>?delete=1</code> to your proxy URL.</div>
				<div class="credit">
					Made with ðŸ’› by
					<a href="https://x.com/rayhanadev" target="_blank" rel="noopener">@rayhanadev</a>
				</div>
			</footer>
		</div>

		<script>
			const form = document.getElementById('form');
			const result = document.getElementById('result');
			const resultUrl = document.getElementById('result-url');
			const copied = document.getElementById('copied');
			const error = document.getElementById('error');
			let generatedUrl = '';

			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				error.textContent = '';
				result.classList.remove('show');

				const url = document.getElementById('url').value.trim();
				if (!url) return;

				const timezone = document.getElementById('timezone').value;

				try {
					const body = { url };
					if (timezone) {
						body.timezone = timezone;
					}

					const res = await fetch('/register', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify(body),
					});

					const data = await res.json();

					if (!res.ok) {
						error.textContent = data.error || 'Failed to register calendar';
						return;
					}

					generatedUrl = data.proxyUrl;
					resultUrl.textContent = generatedUrl;
					result.classList.add('show');
				} catch (err) {
					error.textContent = 'Network error. Please try again.';
				}
			});

			function copyUrl() {
				navigator.clipboard.writeText(generatedUrl).then(() => {
					copied.classList.add('show');
					setTimeout(() => copied.classList.remove('show'), 2000);
				});
			}
		</script>
	</body>
</html>
